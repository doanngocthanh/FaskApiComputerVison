<style>
/* Inline CSS for Card Detection Page */
.card-detection-page {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem 1rem;
}

.page-header {
    text-align: center;
    margin-bottom: 2rem;
}

.page-header h1 {
    font-size: 2.2rem;
    font-weight: bold;
    margin-bottom: 1rem;
    color: #1f2937;
}

.page-header p {
    font-size: 1.1rem;
    color: #6b7280;
}

.upload-section {
    background: white;
    border: 2px dashed #d1d5db;
    border-radius: 12px;
    padding: 3rem 2rem;
    text-align: center;
    margin-bottom: 2rem;
    transition: border-color 0.2s;
}

.upload-section.dragover {
    border-color: #3b82f6;
    background-color: #eff6ff;
}

.upload-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    color: #9ca3af;
}

.upload-text {
    font-size: 1.1rem;
    color: #374151;
    margin-bottom: 1rem;
}

.upload-subtext {
    color: #6b7280;
    font-size: 0.9rem;
    margin-bottom: 2rem;
}

.upload-btn {
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.75rem 2rem;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
}

.upload-btn:hover {
    background: #2563eb;
}

.file-input {
    display: none;
}

.preview-section {
    display: none;
    background: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
}

.preview-image {
    max-width: 100%;
    max-height: 400px;
    border-radius: 8px;
    margin-bottom: 1rem;
}

.result-section {
    display: none;
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
}

.result-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #f9fafb;
    border-radius: 8px;
    margin-bottom: 1rem;
}

.result-label {
    font-weight: 600;
    color: #374151;
}

.result-value {
    color: #3b82f6;
    font-weight: 500;
}

.loading {
    text-align: center;
    padding: 2rem;
}

.loading-spinner {
    display: inline-block;
    width: 2rem;
    height: 2rem;
    border: 3px solid #f3f4f6;
    border-radius: 50%;
    border-top-color: #3b82f6;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.error-message {
    background: #fef2f2;
    color: #dc2626;
    padding: 1rem;
    border-radius: 8px;
    margin-top: 1rem;
    border: 1px solid #fecaca;
}

.success-message {
    background: #f0fdf4;
    color: #16a34a;
    padding: 1rem;
    border-radius: 8px;
    margin-top: 1rem;
    border: 1px solid #bbf7d0;
}

/* Responsive */
@media (max-width: 768px) {
    .card-detection-page {
        padding: 1rem 0.5rem;
    }
    
    .upload-section {
        padding: 2rem 1rem;
    }
    
    .page-header h1 {
        font-size: 1.8rem;
    }
}
</style>

<div class="card-detection-page">
    <div class="page-header">
        <h1>üéØ Card Detection</h1>
        <p>T·∫£i l√™n h√¨nh ·∫£nh ƒë·ªÉ nh·∫≠n di·ªán v√† ph√¢n lo·∫°i lo·∫°i th·∫ª</p>
    </div>

    <div class="upload-section" id="uploadSection">
        <div class="upload-icon">üì§</div>
        <div class="upload-text">K√©o th·∫£ file ho·∫∑c click ƒë·ªÉ ch·ªçn</div>
        <div class="upload-subtext">H·ªó tr·ª£: JPG, PNG, JPEG (t·ªëi ƒëa 10MB)</div>
        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
            Ch·ªçn File
        </button>
        <input type="file" id="fileInput" class="file-input" accept="image/*">
    </div>

    <div class="preview-section" id="previewSection">
        <h3>üì∑ ·∫¢nh ƒë√£ t·∫£i l√™n:</h3>
        <img id="previewImage" class="preview-image" alt="Preview">
        <button class="upload-btn" onclick="processImage()">
            üöÄ Ph√¢n t√≠ch ·∫£nh
        </button>
    </div>

    <div class="loading" id="loadingSection" style="display: none;">
        <div class="loading-spinner"></div>
        <p>ƒêang x·ª≠ l√Ω ·∫£nh...</p>
    </div>

    <div class="result-section" id="resultSection">
        <h3>üìä K·∫øt qu·∫£ ph√¢n t√≠ch:</h3>
        <div id="resultContent"></div>
    </div>
</div>

<script>
// File upload handling
const fileInput = document.getElementById('fileInput');
const uploadSection = document.getElementById('uploadSection');
const previewSection = document.getElementById('previewSection');
const previewImage = document.getElementById('previewImage');
const loadingSection = document.getElementById('loadingSection');
const resultSection = document.getElementById('resultSection');

fileInput.addEventListener('change', handleFileSelect);

// Drag and drop
uploadSection.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadSection.classList.add('dragover');
});

uploadSection.addEventListener('dragleave', () => {
    uploadSection.classList.remove('dragover');
});

uploadSection.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadSection.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        handleFile(files[0]);
    }
});

function handleFileSelect(e) {
    const file = e.target.files[0];
    if (file) {
        handleFile(file);
    }
}

function handleFile(file) {
    if (!file.type.startsWith('image/')) {
        showError('Vui l√≤ng ch·ªçn file ·∫£nh!');
        return;
    }
    
    if (file.size > 10 * 1024 * 1024) {
        showError('File qu√° l·ªõn! Vui l√≤ng ch·ªçn file nh·ªè h∆°n 10MB.');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = (e) => {
        previewImage.src = e.target.result;
        previewSection.style.display = 'block';
        resultSection.style.display = 'none';
    };
    reader.readAsDataURL(file);
}

async function processImage() {
    const file = fileInput.files[0];
    if (!file) return;
    
    loadingSection.style.display = 'block';
    resultSection.style.display = 'none';
    
    const formData = new FormData();
    formData.append('file', file);
    
    try {
        const response = await fetch('/api/v1/card-detection', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        loadingSection.style.display = 'none';
        
        if (response.ok) {
            displayResult(result);
        } else {
            showError(result.detail || 'C√≥ l·ªói x·∫£y ra khi x·ª≠ l√Ω ·∫£nh');
        }
    } catch (error) {
        loadingSection.style.display = 'none';
        showError('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server');
    }
}

function displayResult(result) {
    const resultContent = document.getElementById('resultContent');
    
    let html = '';
    if (result.detected_cards && result.detected_cards.length > 0) {
        result.detected_cards.forEach((card, index) => {
            html += `
                <div class="result-item">
                    <span class="result-label">Lo·∫°i th·∫ª ${index + 1}:</span>
                    <span class="result-value">${card.card_type}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ƒê·ªô tin c·∫≠y:</span>
                    <span class="result-value">${(card.confidence * 100).toFixed(1)}%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">M·∫∑t th·∫ª:</span>
                    <span class="result-value">${card.side}</span>
                </div>
            `;
        });
    } else {
        html = '<div class="error-message">Kh√¥ng ph√°t hi·ªán th·∫ª n√†o trong ·∫£nh</div>';
    }
    
    resultContent.innerHTML = html;
    resultSection.style.display = 'block';
}

function showError(message) {
    const resultContent = document.getElementById('resultContent');
    resultContent.innerHTML = `<div class="error-message">${message}</div>`;
    resultSection.style.display = 'block';
}
</script>
        </div>
        <div class="card-body">
            <div id="detection-results">
                <div class="text-center" style="color: var(--text-secondary);">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">ü§ñ</div>
                    <p>Ch∆∞a c√≥ k·∫øt qu·∫£ nh·∫≠n di·ªán</p>
                    <p style="font-size: 0.875rem;">Upload ·∫£nh th·∫ª ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Supported Cards Info -->
<div class="card mt-4">
    <div class="card-header">
        <h3 class="card-title">üìã Th·∫ª ƒê∆∞·ª£c H·ªó Tr·ª£</h3>
    </div>
    <div class="card-body" id="supported-cards">
        <div class="loading"></div>
        <p>ƒêang t·∫£i danh s√°ch th·∫ª ƒë∆∞·ª£c h·ªó tr·ª£...</p>
    </div>
</div>

<!-- Detection History -->
<div class="card mt-4">
    <div class="card-header">
        <h3 class="card-title">üìä L·ªãch S·ª≠ Nh·∫≠n Di·ªán</h3>
    </div>
    <div class="card-body">
        <div id="detection-history">
            <p style="color: var(--text-secondary); text-align: center;">
                Ch∆∞a c√≥ l·ªãch s·ª≠ nh·∫≠n di·ªán
            </p>
        </div>
        <div class="text-center mt-4">
            <button class="btn btn-outline" id="clear-history-btn">
                üóëÔ∏è X√≥a L·ªãch S·ª≠
            </button>
        </div>
    </div>
</div>
